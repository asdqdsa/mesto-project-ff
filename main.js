(()=>{"use strict";function t(t,e,n,r){var o={method:e,headers:t.headers};return null!=r&&(o.body=JSON.stringify(r)),fetch("".concat(t.baseUrl).concat(n),o).then((function(t){return t.ok?t.json():Promise.reject("Error: ".concat(t.status))}))}var e=document.querySelector("#card-template").content;function n(t,n,r,o,c){var u=e.cloneNode(!0);u.querySelector(".card__like-count").textContent=t.likes.length,u.querySelector(".card__title").textContent=t.name;var i,a,l=u.querySelector(".card__image");(i=t.link,a="https://previews.123rf.com/images/krisckam/krisckam1307/krisckam130700312/20984907-404-error-file-not-found-illustration-vector.jpg",fetch(i).then((function(t){return t.ok?t.url:a})).catch((function(){return a}))).then((function(t){return l.src=t})),u.querySelector(".card__image").alt="Фотография местности ".concat(t.name),u.querySelector(".card__delete-button").addEventListener("click",(function(e){return n(e,t._id)})),u.querySelector(".card__like-button").addEventListener("click",(function(e){return r(e,t._id)})),u.querySelector(".card__image").addEventListener("click",(function(){return o(t.name,t.link)}));var s=u.querySelector(".card__like-button"),d=t.likes.some((function(t){return t._id===c})),f=t.owner._id===c;return d&&s.classList.add("card__like-button_is-active"),f||u.querySelector(".card__delete-button").remove(),u}function r(e,n){var r=e.target,o=e.target.closest(".card").querySelector(".card__like-count");r.classList.contains("card__like-button_is-active")?function(e,n){return t(e,"DELETE","/cards/likes/".concat(n),null)}(p,n).then((function(t){r.classList.toggle("card__like-button_is-active"),o.textContent=t.likes.length})).catch((function(t){return t})):function(e,n){return t(e,"PUT","/cards/likes/".concat(n),null)}(p,n).then((function(t){r.classList.toggle("card__like-button_is-active"),o.textContent=t.likes.length})).catch((function(t){return t}))}function o(e,n){var r=e.target.closest(".card");(function(e,n){return t(e,"DELETE","/cards/".concat(n),null)})(p,n).then((function(t){r.remove(),console.log(t.message)})).catch((function(t){return t}))}function c(t,e,n){e.classList.add(t),document.addEventListener("keydown",n)}function u(t,e,n){e.classList.remove(t),document.removeEventListener("keydown",n)}var i=function(t,e,n){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(n.inputErrorClass),r.classList.remove(n.errorElementClass),r.textContent=""},a=function(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.disabled=!1,e.classList.remove(n.inactiveButtonClass)):(e.disabled=!0,e.classList.add(n.inactiveButtonClass))},l=function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),r=t.querySelector(e.buttonSelector);n.forEach((function(o){i(t,o,e),a(n,r,e)}))};function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var d,f=localStorage.getItem("ACC_ID_MESTO"),p={baseUrl:"https://nomoreparties.co/v1/wff-cohort-4",headers:{authorization:"14f77105-3b2d-422f-94c2-318e8127f8a3","Content-Type":"application/json"}},_={formSelector:".popup__form",inputSelector:".popup__input",buttonSelector:".popup__button",inactiveButtonClass:"popup__button_is-inactive",inputErrorClass:"popup__input-error",errorElementClass:"popup__input-error_active"},m=document.querySelector(".places__list"),v=document.querySelector(".profile__image"),y=document.querySelector(".profile__edit-button"),S=document.querySelector(".profile__add-button"),h=document.querySelector(".profile__title"),g=document.querySelector(".profile__description"),k=document.querySelector(".popup_type_profile"),b=document.querySelector(".popup_type_edit"),E=document.querySelector(".popup_type_new-card"),q=k.querySelector(".popup__close"),C=b.querySelector(".popup__close"),L=E.querySelector(".popup__close"),A=document.querySelector(".popup_type_image"),x=A.querySelector(".popup__image"),w=A.querySelector(".popup__caption"),T=A.querySelector(".popup__close"),j=document.forms["new-picture"],I=j.link,O=document.forms["edit-profile"],D=O.name,M=O.description,P=document.forms["new-place"],U=P["place-name"],B=P.link,G="popup_is-opened",H=[b,E,A,k];function N(t,e){c(G,A,J),x.src=e,x.alt="Фотография местности ".concat(t),w.textContent=t}function V(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];e.forEach((function(t){return t.value=""}))}function z(t,e){e.querySelector(".popup__button").textContent=t?"Сохранение...":"Сохранить"}function J(t){if("Escape"===t.key){var e=document.querySelector(".popup_is-opened");e&&u(G,e,J)}}function $(t,e,n){t.target!==t.currentTarget&&t.target!==n||u(G,e,J)}j.addEventListener("submit",(function(e){return function(e,n){e.preventDefault(),z(!0,n),function(e,n){return function(e,n){return t(e,"PATCH","/users/me/avatar",{avatar:n})}(e,I.value.trim()).then((function(t){v.style.backgroundImage="url(".concat(t.avatar),V(I),u(G,n,J)})).catch((function(t){return console.log(t)}))}(p,n).then((function(){return l(j,_)})).catch((function(t){return t})).finally((function(){return z(!1,n)}))}(e,k)})),O.addEventListener("submit",(function(e){!function(e,n){var r,o,c;e.preventDefault(),z(!0,n),(r=p,o=D.value,c=M.value,t(r,"PATCH","/users/me",{name:o,about:c})).then((function(t){console.log(t),h.textContent=t.name,g.textContent=t.about,u(G,n,J)})).catch((function(t){return console.error(t)})).finally((function(){return z(!1,n)}))}(e,b),l(O,_)})),P.addEventListener("submit",(function(e){return function(e,c){e.preventDefault(),z(!0,c),function(e,c,i,a){(function(e,n,r){return t(e,"POST","/cards",{name:n,link:r})})(p,e.value,c.value.trim()).then((function(t){V(U,B),u(G,i,J),l(P,_),m.prepend(n(t,o,r,N,a))})).catch((function(t){return console.error(t)})).finally((function(){return z(!1,i)}))}(U,B,c,f),l(P,_)}(e,E)})),H.forEach((function(t){return t.classList.add("popup_is-animated")})),v.addEventListener("click",(function(){c(G,k,J)})),y.addEventListener("click",(function(){c(G,b,J),l(O,_),D.value=h.textContent,M.value=g.textContent,c(G,b,J)})),S.addEventListener("click",(function(){c(G,E,J)})),k.addEventListener("click",(function(t){$(t,k,q)})),b.addEventListener("click",(function(t){$(t,b,C)})),E.addEventListener("click",(function(t){$(t,E,L)})),A.addEventListener("click",(function(t){$(t,A,T)})),d=_,Array.from(document.querySelectorAll(d.formSelector)).forEach((function(t){return function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),r=t.querySelector(e.buttonSelector);a(n,r,e),n.forEach((function(o){o.addEventListener("input",(function(){!function(t,e,n){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?i(t,e,n):function(t,e,n,r){var o=t.querySelector(".".concat(e.id,"-error"));e.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorElementClass)}(t,e,e.validationMessage,n)}(t,o,e),a(n,r,e)}))}))}(t,d)})),Promise.all([function(e){return t(e,"GET","/users/me",null)}(p),function(e){return t(e,"GET","/cards",null)}(p)]).then((function(t){var e,c,u=(c=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,c,u,i=[],a=!0,l=!1;try{if(c=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;a=!1}else for(;!(a=(r=c.call(n)).done)&&(i.push(r.value),i.length!==e);a=!0);}catch(t){l=!0,o=t}finally{try{if(!a&&null!=n.return&&(u=n.return(),Object(u)!==u))return}finally{if(l)throw o}}return i}}(e,c)||function(t,e){if(t){if("string"==typeof t)return s(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(t,e):void 0}}(e,c)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=u[0],a=u[1];localStorage.setItem("ACC_ID_MESTO",i._id),h.textContent=i.name,g.textContent=i.about,v.style.backgroundImage="url(".concat(i.avatar,")"),a.forEach((function(t){m.append(n(t,o,r,N,i._id))}))})).catch((function(t){return t}))})();